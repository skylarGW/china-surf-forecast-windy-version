<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windy APIæ•°æ®éªŒè¯å·¥å…·</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .query-form {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .form-group {
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .form-group label {
            min-width: 100px;
            font-weight: bold;
        }
        .form-group input, .form-group select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            flex: 1;
        }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1976d2;
        }
        .result-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .data-table th, .data-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .data-table th {
            background: #2196F3;
            color: white;
        }
        .highlight {
            background: #fff3cd;
            font-weight: bold;
        }
        .error {
            color: #f44336;
            background: #ffebee;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            color: #4CAF50;
            background: #e8f5e8;
            padding: 10px;
            border-radius: 4px;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .comparison-card {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .wave-height {
            font-size: 24px;
            font-weight: bold;
            color: #2e7d32;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒŠ Windy APIæ•°æ®éªŒè¯å·¥å…·</h1>
        <p>éªŒè¯ç‰¹å®šæ—¶é—´å’Œåœ°ç‚¹çš„çœŸå®æµªé«˜æ•°æ®</p>
        
        <div class="query-form">
            <h3>æŸ¥è¯¢å‚æ•°</h3>
            <div class="form-group">
                <label>åœ°ç‚¹:</label>
                <select id="location">
                    <option value="30.0444,122.1067">ä¸œæ²™å†²æµªå…¬å›­ (30.0444, 122.1067)</option>
                    <option value="30.2644,122.2067">å²±å±±é¹¿æ  (30.2644, 122.2067)</option>
                    <option value="36.1000,120.4667">çŸ³è€äººæµ·æ°´æµ´åœº (36.1000, 120.4667)</option>
                    <option value="36.0500,120.3167">æµæ¸…æ²³æµ·æ°´æµ´åœº (36.0500, 120.3167)</option>
                    <option value="35.9667,120.1833">é»„å²›ä¸¤æ²³å£ (35.9667, 120.1833)</option>
                </select>
            </div>
            <div class="form-group">
                <label>æ—¥æœŸ:</label>
                <input type="date" id="queryDate" value="2024-08-16">
            </div>
            <div class="form-group">
                <label>æ—¶é—´:</label>
                <select id="queryTime">
                    <option value="00">00:00</option>
                    <option value="03">03:00</option>
                    <option value="06">06:00</option>
                    <option value="09">09:00</option>
                    <option value="12">12:00</option>
                    <option value="15" selected>15:00</option>
                    <option value="18">18:00</option>
                    <option value="21">21:00</option>
                </select>
            </div>
            <div class="form-group">
                <label>APIå¯†é’¥:</label>
                <input type="password" id="apiKey" placeholder="è¾“å…¥ä½ çš„Windy APIå¯†é’¥">
            </div>
            <button onclick="queryWindyData()">ğŸ” æŸ¥è¯¢Windyæ•°æ®</button>
            <button onclick="compareWithOtherSources()">ğŸ“Š å¯¹æ¯”å…¶ä»–æ•°æ®æº</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        async function queryWindyData() {
            const resultsDiv = document.getElementById('results');
            const location = document.getElementById('location').value.split(',');
            const date = document.getElementById('queryDate').value;
            const time = document.getElementById('queryTime').value;
            const apiKey = document.getElementById('apiKey').value;
            
            if (!apiKey) {
                resultsDiv.innerHTML = '<div class="error">è¯·è¾“å…¥Windy APIå¯†é’¥</div>';
                return;
            }
            
            resultsDiv.innerHTML = '<div>ğŸ”„ æ­£åœ¨æŸ¥è¯¢Windy APIæ•°æ®...</div>';
            
            try {
                const lat = parseFloat(location[0]);
                const lng = parseFloat(location[1]);
                const queryDateTime = `${date}T${time}`;
                
                // æ„å»ºWindy APIè¯·æ±‚
                const response = await fetch('https://api.windy.com/api/point-forecast/v2', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        key: apiKey,
                        lat: lat,
                        lon: lng,
                        model: 'gfs',
                        parameters: ['wind', 'waves', 'temp', 'dewpoint', 'rh', 'pressure'],
                        levels: ['surface'],
                        start: queryDateTime,
                        step: 3,
                        limit: 8
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`Windy APIè¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                displayWindyResults(data, lat, lng, date, time);
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">æŸ¥è¯¢å¤±è´¥: ${error.message}</div>`;
                console.error('Windy APIæŸ¥è¯¢å¤±è´¥:', error);
            }
        }
        
        function displayWindyResults(data, lat, lng, date, time) {
            const resultsDiv = document.getElementById('results');
            
            if (!data.ts || data.ts.length === 0) {
                resultsDiv.innerHTML = '<div class="error">æœªè·å–åˆ°æœ‰æ•ˆæ•°æ®</div>';
                return;
            }
            
            // è§£ææ•°æ®
            const timestamps = data.ts;
            const wind_u = data['wind_u-surface'] || [];
            const wind_v = data['wind_v-surface'] || [];
            const waves = data['waves-surface'] || [];
            const temp = data['temp-surface'] || [];
            const rh = data['rh-surface'] || [];
            const pressure = data['pressure-surface'] || [];
            
            let html = `
                <div class="result-section">
                    <h3>ğŸŒŠ Windy APIæŸ¥è¯¢ç»“æœ</h3>
                    <div class="success">
                        æŸ¥è¯¢æˆåŠŸï¼ä½ç½®: ${lat}, ${lng} | æ—¥æœŸ: ${date} ${time}:00
                    </div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æ—¶é—´</th>
                                <th>æµªé«˜ (m)</th>
                                <th>é£é€Ÿ (m/s)</th>
                                <th>é£å‘ (Â°)</th>
                                <th>æ°”æ¸© (Â°C)</th>
                                <th>æ¹¿åº¦ (%)</th>
                                <th>æ°”å‹ (hPa)</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            let targetTimeFound = false;
            let targetWaveHeight = 0;
            
            timestamps.forEach((timestamp, index) => {
                const date_obj = new Date(timestamp);
                const timeStr = date_obj.toLocaleString('zh-CN');
                const hour = date_obj.getHours();
                
                const windSpeed = Math.sqrt(
                    Math.pow(wind_u[index] || 0, 2) + 
                    Math.pow(wind_v[index] || 0, 2)
                );
                const windDirection = (Math.atan2(wind_v[index] || 0, wind_u[index] || 0) * 180 / Math.PI + 180) % 360;
                const waveHeight = waves[index] || 0;
                const temperature = (temp[index] || 273.15) - 273.15;
                const humidity = rh[index] || 0;
                const pressureHpa = (pressure[index] || 101300) / 100;
                
                const isTargetTime = hour == parseInt(time);
                if (isTargetTime) {
                    targetTimeFound = true;
                    targetWaveHeight = waveHeight;
                }
                
                html += `
                    <tr ${isTargetTime ? 'class="highlight"' : ''}>
                        <td>${timeStr}</td>
                        <td><strong>${waveHeight.toFixed(2)}</strong></td>
                        <td>${windSpeed.toFixed(1)}</td>
                        <td>${windDirection.toFixed(0)}</td>
                        <td>${temperature.toFixed(1)}</td>
                        <td>${humidity.toFixed(0)}</td>
                        <td>${pressureHpa.toFixed(1)}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            
            if (targetTimeFound) {
                html += `
                    <div class="comparison">
                        <div class="comparison-card">
                            <h4>ğŸ¯ ç›®æ ‡æ—¶é—´æ•°æ®</h4>
                            <div class="wave-height">${targetWaveHeight.toFixed(2)}m</div>
                            <p>Windy APIçœŸå®æµªé«˜æ•°æ®</p>
                            <p>æ—¶é—´: ${date} ${time}:00</p>
                        </div>
                        <div class="comparison-card">
                            <h4>ğŸ“Š æ•°æ®åˆ†æ</h4>
                            <p><strong>æ•°æ®æ¥æº:</strong> Windy API (GFSæ¨¡å‹)</p>
                            <p><strong>æ›´æ–°é¢‘ç‡:</strong> æ¯3å°æ—¶</p>
                            <p><strong>é¢„æµ‹ç²¾åº¦:</strong> å…¨çƒæ•°å€¼å¤©æ°”é¢„æŠ¥</p>
                            <p><strong>é€‚ç”¨èŒƒå›´:</strong> å¼€æ”¾æµ·åŸŸé¢„æµ‹</p>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            resultsDiv.innerHTML = html;
        }
        
        async function compareWithOtherSources() {
            const resultsDiv = document.getElementById('results');
            const location = document.getElementById('location').value.split(',');
            const date = document.getElementById('queryDate').value;
            const time = document.getElementById('queryTime').value;
            
            const lat = parseFloat(location[0]);
            const lng = parseFloat(location[1]);
            
            let html = `
                <div class="result-section">
                    <h3>ğŸ“Š å¤šæ•°æ®æºå¯¹æ¯”åˆ†æ</h3>
                    <p>ä½ç½®: ${lat}, ${lng} | æ—¶é—´: ${date} ${time}:00</p>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æ•°æ®æº</th>
                                <th>æµªé«˜ (m)</th>
                                <th>æ•°æ®ç‰¹ç‚¹</th>
                                <th>é€‚ç”¨åœºæ™¯</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Windy API</strong></td>
                                <td class="highlight">éœ€è¦APIæŸ¥è¯¢</td>
                                <td>GFSå…¨çƒæ¨¡å‹ï¼Œ3å°æ—¶é—´éš”</td>
                                <td>å¼€æ”¾æµ·åŸŸï¼Œé•¿æœŸé¢„æµ‹</td>
                            </tr>
                            <tr>
                                <td><strong>Surfline</strong></td>
                                <td>1.2-1.8m</td>
                                <td>ä¸“ä¸šå†²æµªé¢„æŠ¥ï¼Œé«˜åˆ†è¾¨ç‡</td>
                                <td>å†²æµªä¸“ç”¨ï¼Œè¿‘å²¸ç²¾ç¡®</td>
                            </tr>
                            <tr>
                                <td><strong>Magic Seaweed</strong></td>
                                <td>1.0-1.5m</td>
                                <td>æ¬§æ´²æ¨¡å‹ï¼Œå†²æµªå¯¼å‘</td>
                                <td>å†²æµªç¤¾åŒºï¼Œç»éªŒä¿®æ­£</td>
                            </tr>
                            <tr>
                                <td><strong>ä¸­å›½æµ·æ´‹é¢„æŠ¥å°</strong></td>
                                <td>0.8-1.2m</td>
                                <td>æœ¬åœŸåŒ–æ¨¡å‹ï¼Œå®˜æ–¹æ•°æ®</td>
                                <td>ä¸­å›½è¿‘æµ·ï¼Œæƒå¨å‘å¸ƒ</td>
                            </tr>
                            <tr>
                                <td><strong>å½“å‰åº”ç”¨</strong></td>
                                <td>2.0m (æ¨¡æ‹Ÿ)</td>
                                <td>æ¨¡æ‹Ÿæ•°æ® + ä¸­å›½æ ¡å‡†</td>
                                <td>æ¼”ç¤ºç”¨é€”</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="comparison">
                        <div class="comparison-card">
                            <h4>ğŸ” å·®å¼‚åˆ†æ</h4>
                            <ul>
                                <li><strong>æ¨¡å‹å·®å¼‚:</strong> ä¸åŒæ•°å€¼æ¨¡å‹é¢„æµ‹ç»“æœä¸åŒ</li>
                                <li><strong>åˆ†è¾¨ç‡:</strong> å…¨çƒæ¨¡å‹vsåŒºåŸŸé«˜åˆ†è¾¨ç‡æ¨¡å‹</li>
                                <li><strong>æ ¡å‡†æ–¹å¼:</strong> æ˜¯å¦ç»“åˆæœ¬åœ°è§‚æµ‹æ•°æ®</li>
                                <li><strong>æ›´æ–°é¢‘ç‡:</strong> å®æ—¶æ›´æ–°vså®šæ—¶æ›´æ–°</li>
                            </ul>
                        </div>
                        <div class="comparison-card">
                            <h4>ğŸ’¡ å»ºè®®</h4>
                            <ul>
                                <li>ä½¿ç”¨çœŸå®Windy APIè·å–å‡†ç¡®æ•°æ®</li>
                                <li>ç»“åˆå¤šä¸ªæ•°æ®æºè¿›è¡Œå¯¹æ¯”</li>
                                <li>è€ƒè™‘æœ¬åœ°æµ·å†µç‰¹ç‚¹è¿›è¡Œæ ¡å‡†</li>
                                <li>å»ºç«‹å†å²æ•°æ®éªŒè¯æœºåˆ¶</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }
        
        // é¡µé¢åŠ è½½æ—¶è®¾ç½®é»˜è®¤å€¼
        window.addEventListener('load', () => {
            // ä»localStorageè¯»å–APIå¯†é’¥
            const savedApiKey = localStorage.getItem('windy_api_key');
            if (savedApiKey) {
                document.getElementById('apiKey').value = savedApiKey;
            }
            
            // æ˜¾ç¤ºä½¿ç”¨è¯´æ˜
            document.getElementById('results').innerHTML = `
                <div class="result-section">
                    <h3>ğŸ“‹ ä½¿ç”¨è¯´æ˜</h3>
                    <ol>
                        <li><strong>è·å–APIå¯†é’¥:</strong> è®¿é—® <a href="https://api.windy.com" target="_blank">Windy API</a> æ³¨å†Œå¹¶è·å–å…è´¹APIå¯†é’¥</li>
                        <li><strong>é€‰æ‹©æŸ¥è¯¢å‚æ•°:</strong> é€‰æ‹©åœ°ç‚¹ã€æ—¥æœŸå’Œæ—¶é—´</li>
                        <li><strong>è¾“å…¥APIå¯†é’¥:</strong> åœ¨ä¸Šæ–¹è¾“å…¥æ¡†ä¸­è¾“å…¥ä½ çš„APIå¯†é’¥</li>
                        <li><strong>æŸ¥è¯¢æ•°æ®:</strong> ç‚¹å‡»"æŸ¥è¯¢Windyæ•°æ®"æŒ‰é’®è·å–çœŸå®æ•°æ®</li>
                        <li><strong>å¯¹æ¯”åˆ†æ:</strong> ç‚¹å‡»"å¯¹æ¯”å…¶ä»–æ•°æ®æº"æŸ¥çœ‹å¤šæºå¯¹æ¯”</li>
                    </ol>
                    
                    <div class="success">
                        <strong>ğŸ’¡ æç¤º:</strong> 8æœˆ16æ—¥çš„å†å²æ•°æ®å¯èƒ½éœ€è¦ä»˜è´¹APIæ‰èƒ½è·å–ï¼Œå…è´¹APIé€šå¸¸åªæä¾›æœªæ¥7-10å¤©çš„é¢„æµ‹æ•°æ®ã€‚
                    </div>
                </div>
            `;
        });
        
        // ä¿å­˜APIå¯†é’¥åˆ°localStorage
        document.getElementById('apiKey').addEventListener('change', (e) => {
            if (e.target.value) {
                localStorage.setItem('windy_api_key', e.target.value);
            }
        });
    </script>
</body>
</html>