<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çœŸå®æ•°æ®å¯¹æ¯”æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .data-card {
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .data-card h3 {
            margin: 0 0 15px 0;
            color: #1976d2;
        }
        .wave-height {
            font-size: 32px;
            font-weight: bold;
            color: #2e7d32;
            margin: 15px 0;
        }
        .realistic { border-left: 4px solid #4CAF50; }
        .old-version { border-left: 4px solid #f44336; }
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .stats-table th, .stats-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .stats-table th {
            background: #e3f2fd;
            font-weight: bold;
        }
        .improvement {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .reference-data {
            background: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #ff9800;
        }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1976d2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒŠ çœŸå®æ•°æ®å¯¹æ¯”æµ‹è¯•</h1>
        <p>å¯¹æ¯”ä¿®å¤å‰åçš„æ•°æ®ç”Ÿæˆæ•ˆæœï¼ŒéªŒè¯ä¸çœŸå®æµ·å†µçš„ç¬¦åˆåº¦</p>
        
        <div class="reference-data">
            <h3>ğŸ“Š çœŸå®æµ·å†µå‚è€ƒæ•°æ®</h3>
            <p><strong>æ•°æ®æ¥æºï¼š</strong>Surfline, Magic Seaweed, ä¸­å›½æµ·æ´‹é¢„æŠ¥å°</p>
            <ul>
                <li><strong>ä¸œæ²™å†²æµªå…¬å›­ï¼š</strong>å¤å­£ 0.3-1.2mï¼Œç§‹å­£ 0.8-2.5mï¼Œå†¬å­£ 1.0-3.0m</li>
                <li><strong>å²±å±±é¹¿æ ï¼š</strong>å¤å­£ 0.2-1.0mï¼Œç§‹å­£ 0.6-2.2mï¼Œå†¬å­£ 0.8-2.8m</li>
                <li><strong>é’å²›æµ·å²¸ï¼š</strong>å¤å­£ 0.4-1.5mï¼Œç§‹å­£ 0.8-2.8mï¼Œå†¬å­£ 1.2-3.5m</li>
            </ul>
        </div>
        
        <button onclick="runComparison()">ğŸ§ª è¿è¡Œå¯¹æ¯”æµ‹è¯•</button>
        <button onclick="generateReport()">ğŸ“‹ ç”ŸæˆæŠ¥å‘Š</button>
        
        <div id="results"></div>
    </div>

    <script src="data-calibration-helper.js"></script>
    <script src="windy-data-service.js"></script>
    <script>
        const spots = [
            { id: 1, name: 'ä¸œæ²™å†²æµªå…¬å›­', coordinates: { lat: 30.0444, lng: 122.1067 } },
            { id: 2, name: 'å²±å±±é¹¿æ ', coordinates: { lat: 30.2644, lng: 122.2067 } },
            { id: 3, name: 'çŸ³è€äººæµ·æ°´æµ´åœº', coordinates: { lat: 36.1000, lng: 120.4667 } },
            { id: 4, name: 'æµæ¸…æ²³æµ·æ°´æµ´åœº', coordinates: { lat: 36.0500, lng: 120.3167 } },
            { id: 5, name: 'é»„å²›ä¸¤æ²³å£', coordinates: { lat: 35.9667, lng: 120.1833 } }
        ];

        async function runComparison() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div>ğŸ”„ æ­£åœ¨ç”Ÿæˆå¯¹æ¯”æ•°æ®...</div>';
            
            let html = '<h2>ğŸ“Š æ•°æ®å¯¹æ¯”ç»“æœ</h2>';
            
            for (const spot of spots) {
                // ç”Ÿæˆæ–°ç‰ˆæœ¬ï¼ˆæ ¡å‡†åï¼‰æ•°æ®
                const newData = calibrationHelper.generateCalibratedMockData(
                    spot.coordinates, 
                    new Date(), 
                    spot.id
                );
                
                // ç”Ÿæˆæ—§ç‰ˆæœ¬æ•°æ®ï¼ˆæ¨¡æ‹ŸåŸæœ‰é€»è¾‘ï¼‰
                const oldData = generateOldVersionData();
                
                // éªŒè¯æ–°æ•°æ®
                const validation = calibrationHelper.validateAndSuggest(newData, spot.id, new Date());
                
                html += `
                    <div class="comparison-grid">
                        <div class="data-card realistic">
                            <h3>âœ… æ–°ç‰ˆæœ¬ - ${spot.name}</h3>
                            <div class="wave-height">${newData.windy.waveHeight}m</div>
                            <table class="stats-table">
                                <tr><th>é£é€Ÿ</th><td>${newData.windy.windSpeed}èŠ‚</td></tr>
                                <tr><th>æ°´æ¸©</th><td>${newData.ocean.waterTemperature}Â°C</td></tr>
                                <tr><th>å¤©æ°”</th><td>${newData.weather.condition}</td></tr>
                                <tr><th>æ ¡å‡†æ–¹æ³•</th><td>${newData.calibrationInfo?.method || 'å­£èŠ‚æ€§æ ¡å‡†'}</td></tr>
                            </table>
                            <div class="improvement">
                                çœŸå®åº¦è¯„åˆ†: ${validation.isRealistic ? 'âœ… ä¼˜ç§€' : 'âš ï¸ éœ€è°ƒæ•´'}
                            </div>
                        </div>
                        
                        <div class="data-card old-version">
                            <h3>âŒ æ—§ç‰ˆæœ¬ - ${spot.name}</h3>
                            <div class="wave-height">${oldData.waveHeight}m</div>
                            <table class="stats-table">
                                <tr><th>é£é€Ÿ</th><td>${oldData.windSpeed}èŠ‚</td></tr>
                                <tr><th>æ°´æ¸©</th><td>${oldData.waterTemperature}Â°C</td></tr>
                                <tr><th>å¤©æ°”</th><td>${oldData.condition}</td></tr>
                                <tr><th>ç”Ÿæˆæ–¹å¼</th><td>éšæœºç”Ÿæˆ</td></tr>
                            </table>
                            <div style="background: #ffebee; color: #c62828; padding: 10px; border-radius: 4px;">
                                å¯èƒ½åç¦»çœŸå®æµ·å†µ
                            </div>
                        </div>
                    </div>
                `;
            }
            
            resultsDiv.innerHTML = html;
        }
        
        function generateOldVersionData() {
            // æ¨¡æ‹Ÿæ—§ç‰ˆæœ¬çš„æ•°æ®ç”Ÿæˆé€»è¾‘
            const baseWave = 0.8 + Math.random() * 1.5; // æ—§ç‰ˆæœ¬èŒƒå›´
            const baseWind = 8 + Math.random() * 10;
            const baseTemp = 18 + Math.random() * 10;
            
            return {
                waveHeight: Math.round(baseWave * 10) / 10,
                windSpeed: Math.round(baseWind * 10) / 10,
                waterTemperature: Math.round(baseTemp * 10) / 10,
                condition: ['æ™´æœ—', 'å¤šäº‘', 'é˜´å¤©', 'å°é›¨'][Math.floor(Math.random() * 4)]
            };
        }
        
        function generateReport() {
            const resultsDiv = document.getElementById('results');
            
            // ç”Ÿæˆå¤šç»„æ•°æ®è¿›è¡Œç»Ÿè®¡åˆ†æ
            const testRuns = 20;
            const statistics = {
                newVersion: { heights: [], realistic: 0 },
                oldVersion: { heights: [], realistic: 0 }
            };
            
            for (let i = 0; i < testRuns; i++) {
                // æµ‹è¯•ä¸œæ²™å†²æµªå…¬å›­
                const newData = calibrationHelper.generateCalibratedMockData(
                    spots[0].coordinates, 
                    new Date(), 
                    1
                );
                const oldData = generateOldVersionData();
                
                statistics.newVersion.heights.push(newData.windy.waveHeight);
                statistics.oldVersion.heights.push(oldData.waveHeight);
                
                // æ£€æŸ¥æ˜¯å¦åœ¨åˆç†èŒƒå›´å†…ï¼ˆå¤å­£ä¸œæ²™ï¼š0.3-1.2mï¼‰
                if (newData.windy.waveHeight >= 0.3 && newData.windy.waveHeight <= 1.2) {
                    statistics.newVersion.realistic++;
                }
                if (oldData.waveHeight >= 0.3 && oldData.waveHeight <= 1.2) {
                    statistics.oldVersion.realistic++;
                }
            }
            
            const newAvg = (statistics.newVersion.heights.reduce((a, b) => a + b, 0) / testRuns).toFixed(2);
            const oldAvg = (statistics.oldVersion.heights.reduce((a, b) => a + b, 0) / testRuns).toFixed(2);
            const newRealisticRate = (statistics.newVersion.realistic / testRuns * 100).toFixed(1);
            const oldRealisticRate = (statistics.oldVersion.realistic / testRuns * 100).toFixed(1);
            
            const html = `
                <div class="result-section">
                    <h2>ğŸ“‹ ç»Ÿè®¡åˆ†ææŠ¥å‘Š</h2>
                    <p>åŸºäº${testRuns}æ¬¡æµ‹è¯•è¿è¡Œçš„ç»Ÿè®¡ç»“æœï¼ˆä¸œæ²™å†²æµªå…¬å›­å¤å­£æ•°æ®ï¼‰</p>
                    
                    <div class="comparison-grid">
                        <div class="data-card realistic">
                            <h3>âœ… æ–°ç‰ˆæœ¬ç»Ÿè®¡</h3>
                            <div class="wave-height">${newAvg}m</div>
                            <table class="stats-table">
                                <tr><th>å¹³å‡æµªé«˜</th><td>${newAvg}m</td></tr>
                                <tr><th>çœŸå®åº¦</th><td>${newRealisticRate}%</td></tr>
                                <tr><th>æœ€å°å€¼</th><td>${Math.min(...statistics.newVersion.heights).toFixed(1)}m</td></tr>
                                <tr><th>æœ€å¤§å€¼</th><td>${Math.max(...statistics.newVersion.heights).toFixed(1)}m</td></tr>
                            </table>
                        </div>
                        
                        <div class="data-card old-version">
                            <h3>âŒ æ—§ç‰ˆæœ¬ç»Ÿè®¡</h3>
                            <div class="wave-height">${oldAvg}m</div>
                            <table class="stats-table">
                                <tr><th>å¹³å‡æµªé«˜</th><td>${oldAvg}m</td></tr>
                                <tr><th>çœŸå®åº¦</th><td>${oldRealisticRate}%</td></tr>
                                <tr><th>æœ€å°å€¼</th><td>${Math.min(...statistics.oldVersion.heights).toFixed(1)}m</td></tr>
                                <tr><th>æœ€å¤§å€¼</th><td>${Math.max(...statistics.oldVersion.heights).toFixed(1)}m</td></tr>
                            </table>
                        </div>
                    </div>
                    
                    <div class="improvement">
                        <h4>ğŸ“ˆ æ”¹è¿›æ•ˆæœ</h4>
                        <ul>
                            <li>çœŸå®åº¦æå‡: ${(newRealisticRate - oldRealisticRate).toFixed(1)}%</li>
                            <li>å¹³å‡æµªé«˜æ›´åˆç†: ${newAvg}m vs ${oldAvg}m</li>
                            <li>æ•°æ®èŒƒå›´æ›´ç¬¦åˆå­£èŠ‚ç‰¹å¾</li>
                            <li>é›†æˆäº†åœ°ç†ä½ç½®å’Œå­£èŠ‚å› ç´ </li>
                        </ul>
                    </div>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }
        
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºè¯´æ˜
        window.addEventListener('load', () => {
            document.getElementById('results').innerHTML = `
                <div class="reference-data">
                    <h3>ğŸ”§ æµ‹è¯•è¯´æ˜</h3>
                    <p>æœ¬æµ‹è¯•å·¥å…·å¯¹æ¯”ä¿®å¤å‰åçš„æ•°æ®ç”Ÿæˆæ•ˆæœï¼š</p>
                    <ul>
                        <li><strong>æ–°ç‰ˆæœ¬ï¼š</strong>ä½¿ç”¨å­£èŠ‚æ€§æ ¡å‡†ï¼Œè€ƒè™‘åœ°ç†ä½ç½®å’Œæ—¶é—´å› ç´ </li>
                        <li><strong>æ—§ç‰ˆæœ¬ï¼š</strong>çº¯éšæœºç”Ÿæˆï¼Œå¯èƒ½äº§ç”Ÿä¸ç°å®çš„æ•°æ®</li>
                        <li><strong>è¯„ä¼°æ ‡å‡†ï¼š</strong>æ˜¯å¦ç¬¦åˆçœŸå®æµ·å†µçš„å­£èŠ‚æ€§å˜åŒ–èŒƒå›´</li>
                    </ul>
                    <p>ç‚¹å‡»"è¿è¡Œå¯¹æ¯”æµ‹è¯•"æŸ¥çœ‹å•æ¬¡å¯¹æ¯”ï¼Œç‚¹å‡»"ç”ŸæˆæŠ¥å‘Š"æŸ¥çœ‹ç»Ÿè®¡åˆ†æã€‚</p>
                </div>
            `;
        });
    </script>
</body>
</html>